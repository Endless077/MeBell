--Creazione tabelle
create table utente(nickname char(15) primary key, nome varchar(25) not null, cognome varchar(25) not null, password varchar(15) not null );

create table recensione(voto int not null, lunghezza_max varchar(250), creatore char(15) not null, cod_locale char(10) not null );

create table location(cod char(10) primary key, nome varchar(25) not null, cod_res char(5) not null, citta varchar(25) not null, tipo_location varchar(25), check (tipo_location='Alloggio' OR tipo_location='Attrazione' OR tipo_location='Ristorante' ), partita_iva char(11), descrizione varchar(100) );
create table redidenza(via varchar(25) not null, n_civico char(3) not null, cap char(5) not null, comune varchar(25) not null, cod_residenza char(5) primary key );

create table alloggio(cod char(10) not null, n_camere smallint, n_suite smallint, stelle tinyint, tipo_alloggio varchar(25), check(tipo_alloggio='Hotel' OR  tipo_alloggio='B&B',OR  tipo_alloggio='Appartamento') );
create table servizi_alloggio(cod char(10), wi_fi char(1) default 'n', spa char(1) default 'n', piscina char(1) default 'n', aria_condizionata char(1) default 'n', accesso_disabili char(1) default 'n', accesso_animali char(1) default 'n', ascensore char(1) default 'n', servizio_lavanderia char(1) default 'n', tv_stereo char(1) default 'n', parcheggio char(1) default 'n' );

create table attrazione(cod char(10), pagamento char(1) default 'n', tipo_attrazione varchar(25) );

create table ristorante(cod char(10), n_posti smallit, tipo_cucina varchar(25), check(tipo_cucina='Fusion' OR tipo_cucina='Orientale' OR tipo_cucina='Occidentale') );
create table servizi_ristorante(cod(10), fast_food char(1) default 'n', pizzeria char(1) default 'n', braceria char(1) default 'n', birreria char(1) default 'n', pub char(1) default 'n', diner char(1) default 'n', bar char(1) default 'n' );

--Foreign key
alter table recensione add contraint fk_recensione_creatore foreign key (creatore) references utente(nickname);
alter table recensione add contraint fk_recensione_cod_locale foreign key (cod_locale) references location(cod);

alter table location add contraint fk_residenza_cod_residenza foreign key (cod_res) references residenza(cod_residenza);

alter table alloggio add contraint fk_alloggio foreign key (cod) references location(cod);
alter table attrazione add contraint fk_attrazione foreign key (cod) references location(cod);
alter table ristorante add contraint fk_ristorante foreign key (cod) references location(cod);

alter table servizi_alloggio add contraint fk_servizi_hotel foreign key (cod_hotel) references alloggio(cod);
alter table attrazione add contraint tipo_attrazione check(tipo_attrazione='Chiesa' OR tipo_attrazione='Museo' OR tipo_attrazione='Parco' OR tipo_attrazione='Monumento' OR tipo_attrazione='Parco Giochi' OR tipo_attrazione='Centro Sportivo' OR tipo_attrazione='Teatro' OR tipo_attrazione='Cinema' OR tipo_attrazione='Acquario' OR tipo_attrazione='Zona Balneare' OR tipo_attrazione='Zoo');
alter table servizi_ristorazione add contraint fk_servizi_ristorazione foreign key (cod_ristorante) references ristorante(cod);

--Unique
alter table recensione add constraint uc_recensione unique (creatore,cod_locale);
